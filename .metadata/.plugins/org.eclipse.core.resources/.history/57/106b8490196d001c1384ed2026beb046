package com.hycujjang.controller.lectureboard.evaluation;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.PrintWriter;
import java.nio.Buffer;
import java.util.HashMap;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.hycujjang.objectPack.evaluation.EvaluationDAO;
import com.hycujjang.objectPack.evaluation.EvaluationDTO;

@WebServlet("/evaluationRegisterController")
public class EvaluationRegisterController extends HttpServlet{
	@Override
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		BufferedReader br = request.getReader();
		String requestJson = br.readLine();
		System.out.println(requestJson);
		HashMap<String, String> map = new HashMap<>();
		map = getMap(requestJson);

		/*
		if (isWhiteSpace(lectureName) || isWhiteSpace(professorName) || isWhiteSpace(lectureYear)
				|| isWhiteSpace(semesterDivide) || isWhiteSpace(lectureDivide) || isWhiteSpace(evaluationTitle) 
				|| isWhiteSpace(evaluationContent) || isWhiteSpace(totalScore) ||  isWhiteSpace(creditScore)
				|| isWhiteSpace(comfortableScore) || isWhiteSpace(lectureScore)) {
			resultCode = parseJson("isNull");
			response.getWriter().write(resultCode);
			return;
		} else {
			String code = null;
			int id = 0;
			if (evaluationID == null) {
				code = "register";
				id = 0;
			} else {
				code = "update";
				id = Integer.parseInt(evaluationID);
			}
			
			EvaluationDAO evaluationDAO = new EvaluationDAO();
			EvaluationDTO evaluationDTO = new EvaluationDTO(id, userID, lectureName, professorName, Integer.parseInt(lectureYear), 
					semesterDivide, lectureDivide, evaluationTitle, evaluationContent, 
					totalScore, creditScore, comfortableScore, lectureScore, 0);
			
			System.out.println(evaluationDTO);
			int result = 0;
			if (code.equals("register")) {
				evaluationDAO.write(evaluationDTO);
			} else {
				evaluationDAO.update(evaluationDTO);
			}
			
			if (result == -1) {
				//pageBack(response, "강의평가 등록에 실패 했습니다.");
				resultCode = parseJson("error");
			} else {
				//pageBack(response, "정상적으로 등록 되었습니다.");
				resultCode = parseJson("ok");
			}
			
			response.getWriter().write(resultCode);
		}*/

		
	}
	
	private HashMap<String, String> getMap(String json) {
		// 앞에서 넘겨준 데이터 형식 {id: commnetID, password: password}		
		HashMap<String, String> result = new HashMap<String, String>();
		String markRemove = json.replace("{", "").replace("}", "").replace("\"", "");
		String[] split = markRemove.split(",");
		
		for (String cha: split) {
			String[] sp = cha.split(":");
			if (sp.length == 1) {
				return null;
			}
			result.put(sp[0], sp[1]);
		}

		return result;
	}
	
	private String parseJson(String resultCode) {		
		StringBuilder sb = new StringBuilder();
		sb.append("[{\"resultCode\":\"");
		sb.append(resultCode);
		sb.append("\"}]");
		
		return sb.toString();
	}
	
	private boolean isWhiteSpace(String str) {
		if (str == null || str.equals("")) {
			return true;
		}
		return false;
	}
}
