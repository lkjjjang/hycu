package com.hycujjang.controller.lectureboard.evaluation;

import java.io.BufferedReader;
import java.io.IOException;
import java.util.ArrayList;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;
import com.hycujjang.objectPack.comment.CommentDTO;
import com.hycujjang.objectPack.evaluation.EvaluationDAO;
import com.hycujjang.objectPack.evaluation.EvaluationDTO;

@WebServlet("/evaluationRegisterController")
public class Test extends HttpServlet {
	@Override
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		BufferedReader br = request.getReader();
		String requestData = br.readLine();
		Gson gson = new Gson();
		
		// json으로 넘어온 request를 gson이 분해하고 commentDTO를 생성
		EvaluationDTO evaluationDTO = gson.fromJson(requestData, EvaluationDTO.class);
		if (evaluationDTO.isWhiteSpace()) {
			response.getWriter().write("[{\"resultCode\":\"isNull\"}]");
			return;
		}
		
		String resultCode = null;
		EvaluationDAO evaluationDAO = new EvaluationDAO();
		int result = evaluationDAO.write(evaluationDTO);
		if (result == -1) {
			//pageBack(response, "강의평가 등록에 실패 했습니다.");
			resultCode = parseJson("error");
		} else {
			//pageBack(response, "정상적으로 등록 되었습니다.");
			resultCode = parseJson("ok");
		}
	}
	
	private String parseJson(String resultCode) {		
		StringBuilder sb = new StringBuilder();
		sb.append("[{\"resultCode\":\"");
		sb.append(resultCode);
		sb.append("\"}]");
		
		return sb.toString();
	}
}
